{% extends "base.html" %}
{% block content%}
<section>
    <!-- flash messages -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages%}
                <div class="row flashes">
                    <h4 class="center-align yellow-text">{{ message }}</h4>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
</section>

<section>
    <div class="row margin">
        <div class="col s8 offset-s2">
            <div class="page-header">
                Manage Categories
            </div>
            <div class="page-description">
                Curated collections by our editors
            </div>
        </div>
    </div>
</section>

<div class="row margin">
    <div class="col s8 offset-s2">
        <span class="add-category"><a href="{{ url_for('add_category')}}"><i
                    class="material-icons large new-folder">create_new_folder</i>Add a Category</a></span>
    </div>
</div>
<div class="row">
    {% for category in categories %}
    <section>
        <!-- Delete Modal -->
        <div id="delete-modal{{loop.index}}" class="delete-modal modal grey darken-4 white-text center-align">
            <div class="modal-content row">
                <div class="col s12"><i class="material-icons yellow-text">warning</i></div>
                <h5 class="extra-bold yellow-text"> This action cannot be undone</h5>
                <p>Are you sure you want to delete this Category?</p>
            </div>
            <div class="grey darken-4 row center-align">
                <a href="{{ url_for('get_categories')}}"
                    class="modal-close waves-effect waves-green btn col extra-bold s3 offset-s2">Cancel</a>
                <a href="{{ url_for('delete_category', category_id=category._id)}}"
                    class="modal-close waves-effect waves-green btn col extra-bold s3 offset-s2">Delete</a>
            </div>
        </div>
    </section>
    
    <div class="card col s8 offset-s2 grey  darken-4 waves-effect waves-block">
        <div class="card-content activator">
            <i class="large activator material-icons white-text">folder_open</i>
            <a href="#delete-modal{{loop.index}}" class="grey edit grey darken-2 modal-trigger right">Delete</a>
            <a href="{{ url_for('edit_category', category_id=category._id)}}"
                class="grey edit grey darken-2 right">Edit</a>
            <span class="card-title activator white-text extra-bold">{{ category.category_name }}<i
                    class="material-icons right">more_vert</i></span>

        </div>
        <div class="card-reveal black darken-4">
            <span class="card-title grey-text text-darken-4">
                <i class="material-icons right white-text">close</i>
            </span>
            <section id="video-gallery">
                {%- for num in range(0, videos | length, 6) -%}
                <div class="row">
                    <div class="col s12 " id="category-videos">
                        <!-- https://codepen.io/gaeowyn/pen/oiyHF -->
                        <div class=" video-row">
                            <ul>
                                <span class="open-category"><a href="">Explore Category<i
                                            class="material-icons large arrow">arrow_forward</i></a></span>
                                {% for ind in range(videos | length) %}
                                    {% if loop.index > num and ind < (num + 6) %}
                                        {% if videos[ind].category_name == category.category_name %}
                                            <li class="video">
                                                <iframe
                                                    src="{{videos[ind].video_embed_url}}?api=1&autoplay=0&transparent=0&controls=0"
                                                    id="player{{ loop.index + num}}" type="text/html" frameborder="0"
                                                    allow="autoplay; fullscreen; picture-in-picture" webkitallowfullscreen
                                                    mozallowfullscreen allowfullscreen></iframe>
                                            </li>
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                {%- endfor -%}
            </section>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}